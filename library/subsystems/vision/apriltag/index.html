
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../swerve/">
      
      
        <link rel="next" href="../objectdetection/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.47">
    
    
      
        <title>AprilTag - Team 5152 Robot Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="grey">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#photonvision-apriltag-subsystem" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Team 5152 Robot Documentation" class="md-header__button md-logo" aria-label="Team 5152 Robot Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Team 5152 Robot Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AprilTag
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/5152alotobots/5152_Template" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    alotobots/5152_Template
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Team 5152 Robot Documentation" class="md-nav__button md-logo" aria-label="Team 5152 Robot Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Team 5152 Robot Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/5152alotobots/5152_Template" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    alotobots/5152_Template
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Game
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Game
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../game/subsystems/controls/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controls
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Library
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Library
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Commands
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Commands
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../commands/drivefacingbestobject/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DriveFacingBestObject Command
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../commands/pathfindtobestobject/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PathfindToBestObject Command
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../commands/defaultsettoalliancecolor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DefaultSetToAllianceColor Command
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Subsystems
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Subsystems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pneumatics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pneumatics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../swerve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Swerve
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2_4" id="__nav_3_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Vision
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2_4">
            <span class="md-nav__icon md-icon"></span>
            Vision
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    AprilTag
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    AprilTag
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#system-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      System Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      Core Components
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-configuration-and-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      System Configuration and Tuning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="System Configuration and Tuning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#camera-addition-and-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Camera Addition and Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#critical-tuning-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Critical Tuning Parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Critical Tuning Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision-standard-deviations" class="md-nav__link">
    <span class="md-ellipsis">
      Vision Standard Deviations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pose-filter-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Pose Filter Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smoothing-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Smoothing Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tuning-process" class="md-nav__link">
    <span class="md-ellipsis">
      Tuning Process
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Vision Pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vision Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-acquisition-and-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Data Acquisition and Processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pose-estimation-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Pose Estimation Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outlier-rejection-system" class="md-nav__link">
    <span class="md-ellipsis">
      Outlier Rejection System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pose-smoothing-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Pose Smoothing Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-camera-fusion" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Camera Fusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-robot-odometry" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Robot Odometry
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling-and-robustness" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling and Robustness
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../objectdetection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Object Detection
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../5152_Template/javadoc" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Documentation
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#system-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      System Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      Core Components
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-configuration-and-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      System Configuration and Tuning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="System Configuration and Tuning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#camera-addition-and-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Camera Addition and Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#critical-tuning-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Critical Tuning Parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Critical Tuning Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision-standard-deviations" class="md-nav__link">
    <span class="md-ellipsis">
      Vision Standard Deviations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pose-filter-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Pose Filter Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smoothing-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Smoothing Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tuning-process" class="md-nav__link">
    <span class="md-ellipsis">
      Tuning Process
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Vision Pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vision Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-acquisition-and-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Data Acquisition and Processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pose-estimation-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Pose Estimation Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outlier-rejection-system" class="md-nav__link">
    <span class="md-ellipsis">
      Outlier Rejection System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pose-smoothing-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Pose Smoothing Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-camera-fusion" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Camera Fusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-robot-odometry" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Robot Odometry
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling-and-robustness" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling and Robustness
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="photonvision-apriltag-subsystem">PhotonVision AprilTag Subsystem</h1>
<h2 id="system-architecture">System Architecture</h2>
<p>The PhotonVision AprilTag subsystem implements a robust vision-based pose estimation system using multiple cameras to track AprilTag fiducial markers. The system processes multiple camera feeds simultaneously, fuses their data, and produces highly accurate pose estimates through sophisticated filtering and smoothing algorithms.</p>
<h2 id="core-components">Core Components</h2>
<p>The system is built around three main components that work together:</p>
<p>The PhotonvisionAprilTagSubsystem serves as the primary controller, managing the vision pipeline and pose estimation process. It interfaces with multiple PhotonCamera instances, each configured with specific mounting offsets and orientations relative to the robot's center. The subsystem maintains a collection of PhotonPoseEstimator objects that handle the geometric calculations for each camera.</p>
<p>The PhotonvisionAprilTagTelemetry component provides real-time visualization and debugging capabilities, managing the data flow to Shuffleboard for monitoring system performance and pose estimates.</p>
<p>PhotonvisionAprilTagSubsystemConstants contains the configuration parameters that define camera positions, filtering thresholds, and system behavior settings.</p>
<h2 id="system-configuration-and-tuning">System Configuration and Tuning</h2>
<h3 id="camera-addition-and-configuration">Camera Addition and Configuration</h3>
<p>Adding new cameras to the system requires modifications to both the hardware setup and software configuration. Each camera needs proper physical mounting with known offsets from the robot's center point, and corresponding configuration in the constants file.</p>
<p>To add a new camera:</p>
<ol>
<li>Mount the camera securely on the robot</li>
<li>Measure the camera's position relative to robot center:<ul>
<li>X: Distance forward from robot center (positive forward)</li>
<li>Y: Distance left from robot center (positive left)</li>
<li>Z: Height from ground (positive up)</li>
</ul>
</li>
<li>
<p>Measure the camera's rotation:</p>
<ul>
<li>Roll: Rotation around forward axis</li>
<li>Pitch: Rotation around side axis</li>
<li>Yaw: Rotation around vertical axis</li>
</ul>
</li>
<li>
<p>Add the camera configuration to PhotonvisionAprilTagSubsystemConstants:</p>
</li>
</ol>
<pre><code class="language-java">// Add camera object to CAMERAS array
public static final PhotonCamera[] CAMERAS = new PhotonCamera[] {
    new PhotonCamera(&quot;FL_AprilTag&quot;),
    new PhotonCamera(&quot;FM_AprilTag&quot;),
    new PhotonCamera(&quot;NewCamera_AprilTag&quot;)  // Add new camera
};

// Add corresponding offset to CAMERA_OFFSETS array
public static final Transform3d[] CAMERA_OFFSETS = new Transform3d[] {
    // Existing cameras...
    new Transform3d(
        new Translation3d(x, y, z),
        new Rotation3d(roll, pitch, yaw)
    )
};
</code></pre>
<h3 id="critical-tuning-parameters">Critical Tuning Parameters</h3>
<p>The system's performance depends heavily on proper tuning of several key parameters in PhotonvisionAprilTagSubsystemConstants:</p>
<h4 id="vision-standard-deviations">Vision Standard Deviations</h4>
<pre><code class="language-java">public static final Matrix&lt;N3, N1&gt; VISION_STD_DEVS
</code></pre>
<p>These values determine how much the system trusts vision measurements relative to odometry:
- Lower values (0.001-0.1): High trust in vision
- Higher values (0.5-1.0): Lower trust in vision
- Start with higher values and decrease gradually while monitoring stability</p>
<h4 id="pose-filter-parameters">Pose Filter Parameters</h4>
<pre><code class="language-java">public static final double MAX_POSE_DEVIATION_METERS = 1.0;
public static final double MIN_TAG_WEIGHT = 0.3;
public static final double MAX_TAG_WEIGHT = 1.0;
</code></pre>
<p>These parameters control the outlier rejection and pose weighting system:
- MAX_POSE_DEVIATION_METERS: Increase if legitimate poses are being rejected, decrease if false poses are being accepted
- MIN/MAX_TAG_WEIGHT: Adjust the influence of single vs multi-tag detections</p>
<h4 id="smoothing-parameters">Smoothing Parameters</h4>
<pre><code class="language-java">public static final double POSITION_ALPHA = 0.05;
public static final double ROTATION_ALPHA = 0.05;
</code></pre>
<p>These control the trade-off between smoothness and responsiveness:
- Lower values (0.01-0.1): Smoother but more latent
- Higher values (0.1-0.3): More responsive but potentially jittery
- Position and rotation can be tuned independently based on robot behavior</p>
<h3 id="tuning-process">Tuning Process</h3>
<ol>
<li>
<p>Start with conservative values:</p>
<ul>
<li>High vision standard deviations</li>
<li>High MAX_POSE_DEVIATION_METERS</li>
<li>Low smoothing alphas</li>
</ul>
</li>
<li>
<p>Test basic functionality:</p>
<ul>
<li>Verify all cameras are detecting tags</li>
<li>Check pose estimates against known positions</li>
<li>Monitor for obvious outliers</li>
</ul>
</li>
<li>
<p>Iterative refinement:</p>
<ul>
<li>Gradually lower vision standard deviations while monitoring pose stability</li>
<li>Adjust MAX_POSE_DEVIATION_METERS to balance outlier rejection</li>
<li>Fine-tune smoothing alphas based on robot movement characteristics</li>
</ul>
</li>
<li>
<p>Validation:</p>
<ul>
<li>Test under competition conditions</li>
<li>Verify performance during rapid movement</li>
<li>Check reliability with partially obscured tags</li>
</ul>
</li>
</ol>
<p>Monitor the telemetry output during tuning to observe the effect of parameter changes on system performance. The field visualization and pose graphs are particularly useful for identifying issues during the tuning process.</p>
<h2 id="vision-pipeline">Vision Pipeline</h2>
<h3 id="data-acquisition-and-processing">Data Acquisition and Processing</h3>
<p>The vision pipeline begins in the periodic loop where each camera captures frames independently. The system processes these frames asynchronously to identify AprilTags using PhotonVision's detection algorithms. For each detected tag, the system calculates a camera-relative pose using PNP (Perspective-n-Point) algorithms.</p>
<p>The raw camera data undergoes several processing stages:</p>
<ol>
<li>Tag Detection: Each camera processes its image to identify AprilTags in its field of view.</li>
<li>Pose Calculation: The system calculates individual pose estimates based on the detected tags.</li>
<li>Multi-Tag Fusion: When multiple tags are visible, their poses are combined for improved accuracy.</li>
<li>Cross-Camera Fusion: Poses from different cameras are merged using weighted averaging.</li>
</ol>
<h3 id="pose-estimation-algorithm">Pose Estimation Algorithm</h3>
<p>The pose estimation process employs a sophisticated multi-stage algorithm:</p>
<p>First, the system collects pose estimates from all available cameras. Each estimate includes information about the tags used for the calculation and their detection confidence. The system then applies an outlier rejection algorithm that compares poses against the median position, filtering out estimates that deviate significantly from the consensus.</p>
<p>The remaining poses undergo a weighted averaging process. The weighting system considers several factors:
- Number of visible tags (more tags increase weight)
- Tag pose ambiguity (lower ambiguity increases weight)
- Historical reliability of the camera</p>
<p>The weighted averaging process uses exponential smoothing to reduce jitter while maintaining responsiveness. Position and rotation are smoothed independently with configurable smoothing factors.</p>
<h3 id="outlier-rejection-system">Outlier Rejection System</h3>
<p>The outlier rejection system uses a statistical approach to identify and remove unreliable pose estimates. It calculates the median position of all estimates and measures the deviation of each estimate from this median. Estimates that exceed a configurable maximum deviation threshold are excluded from the final pose calculation.</p>
<p>The system also considers the geometric consistency of poses when multiple tags are visible. If the relative positions of detected tags don't match their known field positions within tolerance, the system can identify and reject inconsistent measurements.</p>
<h3 id="pose-smoothing-implementation">Pose Smoothing Implementation</h3>
<p>The pose smoothing system uses exponential smoothing with separate smoothing factors for position and rotation. This dual-factor approach allows fine-tuning of the smoothing behavior independently for translational and rotational movements.</p>
<p>The smoothing algorithm maintains state between updates, storing the last smoothed pose. New pose estimates are combined with this historical data using the configurable alpha factors:</p>
<pre><code>smoothed_value = alpha * new_value + (1 - alpha) * previous_smoothed_value
</code></pre>
<p>Lower alpha values produce smoother output but increase latency, while higher values provide more responsive updates but may introduce more jitter.</p>
<h3 id="multi-camera-fusion">Multi-Camera Fusion</h3>
<p>The multi-camera fusion system combines pose estimates from different perspectives to improve accuracy and reliability. Each camera contributes to the final pose estimate based on its current view quality and historical reliability.</p>
<p>The fusion process handles several challenges:
- Temporal alignment of measurements from different cameras
- Resolution of conflicting pose estimates
- Handling of partial visibility conditions
- Compensation for camera calibration uncertainties</p>
<p>The system uses a weighted average approach that considers the number of tags visible to each camera and the geometric quality of the view (based on tag size and angle in the image).</p>
<h3 id="integration-with-robot-odometry">Integration with Robot Odometry</h3>
<p>The subsystem integrates with the robot's odometry system through the SwerveDriveSubsystem interface. Vision measurements are added to the odometry system with appropriate uncertainty values, allowing the robot's state estimator to fuse vision data with other sensor inputs.</p>
<p>The vision standard deviations are configurable through a covariance matrix, enabling fine-tuning of how much the system trusts vision measurements relative to other sensors.</p>
<h2 id="error-handling-and-robustness">Error Handling and Robustness</h2>
<p>The system implements comprehensive error handling to maintain operation under various failure conditions:</p>
<ul>
<li>Camera disconnections are detected and handled gracefully</li>
<li>Individual camera failures don't compromise the entire system</li>
<li>Network communication issues are managed through timeout mechanisms</li>
<li>Invalid pose estimates are filtered out before they can affect robot behavior</li>
</ul>
<p>The system can continue operating with reduced accuracy when some cameras are unavailable, automatically adjusting its fusion algorithms to work with the remaining functional cameras.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>